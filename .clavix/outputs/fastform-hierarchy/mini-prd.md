# Requirements: Fastform Information Hierarchy

*Generated from conversation on 2026-01-06*

## Objective

Simplify the fastform codebase information hierarchy to be easy to reason about for both humans and AI agents. Establish a clean User → Apps → Chats model with consistent naming conventions.

## Core Requirements

### Must Have (High Priority)

- [HIGH] **New `apps` table** with columns: `id`, `userId`, `name`, `createdAt` (all camelCase)
- [HIGH] **Update `chatOwnerships` table** to add `appId` foreign key linking chats to apps
- [HIGH] **Migrate existing tables to camelCase** column names:
  - `users`: `created_at` → `createdAt`
  - `chat_ownerships`: `user_id` → `userId`, `v0_chat_id` → `v0ChatId`, `created_at` → `createdAt`
  - `anonymous_chat_logs`: `ip_address` → `ipAddress`, `v0_chat_id` → `v0ChatId`, `created_at` → `createdAt`
- [HIGH] **App CRUD API routes**: `/api/apps` (list, create), `/api/apps/[appId]` (get, delete with cascade)
- [HIGH] **Require app selection before chat creation** — no orphan chats allowed
- [HIGH] **Cascade delete** — deleting an app deletes all its chats

### Should Have (Medium Priority)

- [MEDIUM] **Update UI flow** — home page shows apps, app detail shows chats for that app
- [MEDIUM] **Use `[appId]` route parameter** — currently defined but unused, needs to be wired up
- [MEDIUM] **Scope chat routes to apps** — chat operations should validate app ownership

### Could Have (Low Priority / Inferred)

- [LOW] Chats cannot be moved between apps (immutable assignment)

## Technical Constraints

- **Framework/Stack**: Next.js, Drizzle ORM, PostgreSQL, v0 SDK
- **Naming Convention**: camelCase for all database column names
- **Terminology**: "app" everywhere in code/DB/API/UI; "project" only at v0 API boundary layer
- **Data Model**: Chats live in v0 API; local DB tracks ownership only

## User Context

**Target Users:** Non-tech-savvy users building apps via AI chat
**Primary Use Case:** Create apps, have conversations within each app to build features
**User Flow:**
1. User logs in
2. User sees list of their apps (or creates first app)
3. User selects an app
4. User starts/continues chats within that app

## Entity Relationships

```
User (1)
 └── Apps (many)
      └── Chats (many)
```

**Rules:**
- Apps belong to users (no organizations for now)
- Chats belong to apps (no orphans)
- Deleting app cascades to chats
- Chats stay in original app (no moving)

## Edge Cases & Considerations

- [HIGH] What happens to existing chats without an app? → Need migration strategy (create default app or assign to first app)
- [MEDIUM] Rate limiting still applies at user level via `chatOwnerships`
- [LOW] Anonymous users (`anonymous_chat_logs`) don't have apps — this table tracks IP-based rate limiting only

## Success Criteria

How we know this is complete and working:
- ✓ Database schema has `apps` table with proper foreign keys
- ✓ All column names are camelCase across all tables
- ✓ Creating a chat requires selecting an app first
- ✓ Deleting an app removes all associated chats
- ✓ UI shows apps on home, chats within app detail view
- ✓ `[appId]` route parameter is used and validated
- ✓ Codebase uses "app" terminology consistently (except v0 API calls)

## Next Steps

1. Review this PRD for accuracy and completeness
2. Use `/clavix:plan` to generate implementation tasks
3. Implement with `/clavix:implement`

---
*This PRD was generated by Clavix from conversational requirements gathering.*
